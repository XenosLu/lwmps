<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="shortcut icon" href="/static/favicon.ico" />
    <link rel="apple-touch-icon" sizes="200x200" href="/static/apple-touch-icon.png" />
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap-vue.css" rel="stylesheet">
    <link href="/static/css/open-iconic-bootstrap.css" rel="stylesheet">
    <link href="{{ static_url('css/common.css') }}" rel="stylesheet">
    <script src="/static/js/vue.min.js"></script>
    <script src="/static/js/bootstrap-vue.js"></script>
    <title>Light Media Player</title>
  </head>
  <body>
    <div id="v-main" class="flex-center">
      <!-- output box -->
      <transition @enter="outFadeIn"
                  @leave="outFadeOut">
        <div v-if="output.show" :key="output.text+Math.random()" class="output-container justify-content-center flex-center position-fixed">
          <div class="output">
            <small class="d-block">${ output.smallText }</small>
            ${ output.text }
          </div>
        </div>
      </transition>
      <!-- output box end -->
      <!-- nav bar -->
      <b-navbar v-show="fixBar.show" fixed toggleable="lg" type="light" class="default-bg z-index-1050 col-md-8 col-lg-11 col-xl-7">
        <b-btn-group>
          <b-btn variant="outline-secondary" title="browser" @click="showModal">
            <i v-show="!browserShow" class="oi oi-list"></i>
            <i v-show="browserShow" class="oi oi-x"></i>
          </b-btn>
          <b-btn v-if="!wpMode"
                 variant="outline-success"
                 title="switch DLNA mode"
                 :pressed="dlnaMode"
                 @click="dlnaToogle">
            DLNA <i v-show="dlnaOn" class="oi oi-monitor"></i>
          </b-btn>
          <b-btn v-if="wpMode" variant="outline-warning" @click="dlnaToogle">
            <i class="oi oi-x"></i>
            <small class="d-sm-inline d-none">Close</small>
          </b-btn>
        </b-btn-group>
        <b-btn-group v-show="browserShow" class="mx-1">
          <b-btn @click="showHistory" :pressed="historyShow" variant="outline-dark">
            <i class="oi oi-clock"></i>
            <small class="d-sm-inline d-none">History</small>
          </b-btn>
          <!-- <b-btn @click="server.file_list({path: ''}, fileSystemCallBack)" :pressed="!historyShow" variant="outline-dark"> -->
          <b-btn @click="open('', 'folder')" :pressed="!historyShow" variant="outline-dark">
            <i class="oi oi-home"></i>
            <small class="d-sm-inline d-none">Home dir</small>
          </b-btn>
        </b-btn-group>
        <b-btn v-show="browserShow" @click="editMode=!editMode" variant="outline-dark" :pressed="editMode">
          <i class="oi oi-circle-check"></i>
          <small class="d-sm-inline d-none">edit</small>
        </b-btn>
        <b-navbar-toggle v-show="!browserShow" target="nav_collapse"></b-navbar-toggle>
        <b-collapse is-nav id="nav_collapse" v-model="navCollapse">
          <b-navbar-nav>
            <b-nav-item v-if="false">test</b-nav-item>
          </b-navbar-nav>
          <!-- Right aligned nav items -->
          <b-navbar-nav class="ml-auto">
            <b-nav-item-dropdown right>
              <template slot="button-content">
                <i class="oi oi-cog"></i>Maintainance
              </template>
              <b-dropdown-item v-if="devMode" @click="server.self_update()">update</b-dropdown-item>
              <b-dropdown-divider v-if="devMode"></b-dropdown-divider>
              <b-dropdown-item @click="server.db_backup()">backup</b-dropdown-item>
              <b-dropdown-item @click="server.db_restore()">restore</b-dropdown-item>
              <b-dropdown-item v-if="devMode" @click="server.test()">test</b-dropdown-item>
              <!-- <b-dropdown-item v-if="devMode" @click="test">test</b-dropdown-item> -->
            </b-nav-item-dropdown>
          <!-- dlna dmr menu -->
            <b-nav-item-dropdown v-show="dlnaMode" right :text="dlnaInfo.CurrentDMR">
              <b-dropdown-item @click="server.dlna_search()">Search DMR</b-dropdown-item>
              <b-dropdown-divider></b-dropdown-divider>
              <b-dropdown-item v-for="item in dlnaInfo.DMRs" @click="setDmr(item)">
                ${ item }
              </b-dropdown-item>
            </b-nav-item-dropdown>
          <!-- dlna dmr menu end -->
          <!-- dlna seek menu -->
            <b-nav-item-dropdown v-show="dlnaMode" right>
              <template slot="button-content">
                Seek
              </template>
              <b-dropdown-item @click="server.dlna_seek({position: '00:00:15'})">00:15</b-dropdown-item>
              <b-dropdown-item @click="server.dlna_seek({position: '00:00:29'})">00:30</b-dropdown-item>
              <b-dropdown-item @click="server.dlna_seek({position: '00:01:00'})">01:00</b-dropdown-item>
              <b-dropdown-item @click="server.dlna_seek({position: '00:01:30'})">01:30</b-dropdown-item>
            </b-nav-item-dropdown>
          <!-- dlna seek menu end -->
            <b-nav-item v-show="wpMode" @click="videoSizeToggle">${ video.sizeBtnText }</b-nav-item>
            <b-nav-item-dropdown v-show="wpMode" right>
              <template slot="button-content">
                Rate
              </template>
              <b-dropdown-item @click="rate(0.5)">0.5X</b-dropdown-item>
              <b-dropdown-item @click="rate(0.75)">0.75X</b-dropdown-item>
              <b-dropdown-divider></b-dropdown-divider>
              <b-dropdown-item @click="rate(1)">1X</b-dropdown-item>
              <b-dropdown-divider></b-dropdown-divider>
              <b-dropdown-item @click="rate(1.5)">1.5X</b-dropdown-item>
              <b-dropdown-item @click="rate(1.75)">1.75X</b-dropdown-item>
              <b-dropdown-item @click="rate(2)">2X</b-dropdown-item>
              <b-dropdown-item @click="rate(2.5)">2.5X</b-dropdown-item>
              <!-- <b-dropdown-divider></b-dropdown-divider> -->
              <!-- <b-dropdown-item @click="videoSizeToggle">${ video.sizeBtnText }</b-dropdown-item> -->
            </b-nav-item-dropdown>
          </b-navbar-nav>
        </b-collapse>
      </b-navbar>
      <!-- nav bar end -->
      <!-- dropdown window -->
      <div v-show="browserShow" class="col-xs-12 col-sm-12 col-md-10 col-lg-8 col-xl-6 z-index-1040">
        <div class="card window">
          <div class="card-header"></div>
          <div class="table-responsive-sm text-center auto-overflow">
            <table v-show="historyShow" class="table table-striped table-sm">
              <tr v-for="item in history">
                <td v-show="editMode">
                  <b-btn variant="danger" @click="remove(item.fullpath)">
                    <i class="oi oi-circle-x"></i>
                  </b-btn>
                </td>
                <td class="d-sm-table-cell d-none iconOnly"><i class="oi oi-video"></i></td>
                <td @click="open(item.fullpath, 'mp4')"
                    v-press="pressOpen"
                    :data-target="item.path"
                    class="break-all">
                  <span :class="item.exist ? 'mp4' : 'other'">${ item.filename }</span>
                  <br>
                  <small class="text-muted">
                    ${ item.latest_date } |
                    ${ secondToTime(item.position) } /
                    ${ secondToTime(item.duration) }
                  </small>
                </td>
                <!-- <td class="d-sm-table-cell d-none"> -->
                  <!-- <b-btn variant="danger" @click="if(confirm('Confirm remove?'))remove(item.filename)"> -->
                    <!-- <i class="oi oi-circle-x"></i> -->
                  <!-- </b-btn> -->
                <!-- </td> -->
                <td class="iconOnly">
                  <b-dropdown v-show="!editMode" no-caret toggle-class="text-dark" variant="link">
                    <template slot="button-content">
                      <i class="oi oi-ellipses rotate-90"></i>
                    </template>
                    <b-dropdown-header>${ item.filename }</b-dropdown-header>
                    <b-dropdown-item @click="open(item.fullpath, 'mp4')">
                      <i class="oi oi-media-play"></i>Play
                    </b-dropdown-item>
                    <b-dropdown-item @click="server.dlna_next({src: item.fullpath})" v-if="devMode">
                      <i class="oi oi-media-step-forward"></i>Play next through DLNA
                    </b-dropdown-item>
                    <b-dropdown-item @click="open(item.path, 'folder')">
                      <!-- <i class="oi oi-folder"></i>go directory -->
                      <i class="oi oi-folder"></i>${ item.path }
                    </b-dropdown-item>
                    <b-dropdown-divider></b-dropdown-divider>
                    <b-dropdown-item @click="if(confirm('Confirm move?'))move(item.fullpath)">
                      <i class="oi oi-circle-x"></i>move file to .old
                    </b-dropdown-item>
                    <b-dropdown-item @click="if(confirm('Confirm remove?'))remove(item.fullpath)">
                      <i class="oi oi-circle-x"></i>remove from history
                    </b-dropdown-item>
                  </b-dropdown>
                </td>
              </tr>
            </table>
            <table v-show="!historyShow" class="table table-striped table-sm">
              <tr v-for="item in filelist">
                <td v-show="editMode" class="iconOnly">
                  <b-btn variant="danger" @click="move(item.path)">
                    <i class="oi oi-circle-x"></i>
                  </b-btn>
                </td>
                <td class="iconOnly"><i :class="icon[item.type]" class="oi"></i></td>
                 <!-- @click="open(item.path, item.type)" -->
                <td :class="item.type" v-tap="tapOpen" :data-type="item.type" :data-path="item.path" class="break-all">
                  ${ item.filename }
                  <br>
                  <small class="text-muted">${ item.size }</small>
                </td>
                <!-- <td class="iconOnly d-sm-table-cell d-none"> -->
                <!-- <td class="iconOnly" v-show="!editMode"> -->
                  <!-- <b-btn variant="danger" @click="if(confirm('Confirm move?'))move(item.path)"> -->
                    <!-- <i class="oi oi-circle-x"></i> -->
                  <!-- </b-btn> -->
                <!-- </td> -->
                <td class="iconOnly">
                  <b-dropdown v-show="!editMode" no-caret toggle-class="text-dark" variant="link">
                    <template slot="button-content">
                      <i class="oi oi-ellipses rotate-90"></i>
                    </template>
                    <b-dropdown-header>${ item.filename }</b-dropdown-header>
                    <b-dropdown-item @click="open(item.path, item.type)">
                      <i class="oi oi-media-play"></i>Open
                    </b-dropdown-item>
                    <b-dropdown-divider></b-dropdown-divider>
                    <b-dropdown-item @click="if(confirm('Confirm move?'))move(item.path)">
                      <i class="oi oi-circle-x"></i>move file to .old
                    </b-dropdown-item>
                  </b-dropdown>
                </td>
              </tr>
            </table>
          </div>
          <div class="card-footer text-center">
            <b-btn v-show="historyShow" @click="clearHistory" size="sm" variant="outline-dark">
              Clear
            </b-btn>
            <b-button-close @click="browserShow=false"></b-button-close>
          </div>
        </div>
      </div>
      <!-- dropdown window end -->
      <!-- video -->
      <video webkit-playsinline="true"
             playsinline=""
             v-if="wpMode"
             ref="video"
             @timeupdate="videosave"
             @seeking="videoseek"
             @error="videoerror"
             @loadedmetadata  ="videoAdapt"
             @loadeddata="videoload"
             @progress="videoprogress"
             :key="video.src"
             :src="'/video/' + video.src"
             poster controls preload="meta">
        No video support!
      </video>
      <!-- video end-->
      <!-- dlna interface -->
      <div v-if="dlnaMode" class="text-center col-sm-10 col-md-8 col-lg-6 col-xl-4">
        <b-card v-pan="dlnaTouch"
                v-swipe="dlnaTouch"
                bg-variant="light"
                :title="dlnaInfo.TrackURI ? decodeURI(dlnaInfo.TrackURI) : ''"
                class="title break-all my-3">
        </b-card>
      </div>
      <div v-show="dlnaMode" class="fixed-bottom text-center default-bg flex-center">
        <div class="card-body col-sm-12 col-md-8 col-lg-6 col-xl-4">
          <h6 class="card-subtitle text-muted">${ dlnaInfo.CurrentTransportState }</h6>
          <h6 v-show="dlnaInfo.RelTime" class="card-title my-2">
            ${ dlnaInfo.RelTime} / ${ dlnaInfo.TrackDuration }
          </h6>
          <input class="position-bar mb-3 mt-1"
                 v-model.number="positionBarVal"
                 type="range"
                 min="0"
                 :max="positionBarMax"
                 @change="positionSeek"
                 @input="positionShow">
          <b-btn-toolbar justify class="my-2 text-center">
            <b-btn-group>
              <b-btn class="mx-1" variant="outline-warning" v-tap="volDown">
                  <i class="oi oi-volume-low"></i>
              </b-btn>
            </b-btn-group>
            <b-btn-group>
              <b-btn variant="outline-success" @click="server.dlna({opt: 'play'})">
                  <i class="oi oi-media-play"></i>
              </b-btn>
              <b-btn class="ml-1" variant="outline-danger" @click="server.dlna({opt: 'pause'})">
                  <i class="oi oi-media-pause"></i>
              </b-btn>
              <b-btn class="ml-1" variant="outline-danger" @click="server.dlna({opt: 'stop'})">
                  <i class="oi oi-media-stop"></i>
              </b-btn>
              <b-btn class="ml-1" variant="outline-success" @click="server.dlna_next()">
                  <i class="oi oi-media-step-forward"></i>
              </b-btn>
            </b-btn-group>
            <b-btn-group>
              <b-btn class="mx-1" variant="outline-warning" v-tap="volUp">
                <i class="oi oi-volume-high"></i>
              </b-btn>
            </b-btn-group>
          </b-btn-toolbar>
          </div>
      </div>
      <!-- dlna interface end -->
    </div>
    <footer class="text-center">
      <small class="text-muted">&copy;2016-2018 Xenos' Light Media Player</small>
    </footer>
  </body>
  <script src="/static/js/velocity.min.js"></script>
  <script src="/static/js/axios.min.js"></script>
  <script src="/static/js/reconnecting-websocket.min.js"></script>
  <!-- <script src="/static/js/jquery-3.2.1.min.js"></script> -->
  <script src="/static/js/hammer.min.js"></script>
  <script src="{{ static_url('js/common.js') }}"></script>
  <script src="{{ static_url('js/main.js') }}"></script>
</html>
